#!/usr/bin/env bash
set -eo pipefail; [[ $DOKKU_TRACE ]] && set -x

SSH_KEYGEN=`which ssh-keygen`
SHARED_KEY_FOLDER="$DOKKU_ROOT/.deployment-keys/shared/.ssh"

if [[ ! -d "$SHARED_KEY_FOLDER/.ssh" ]]; then
  mkdir -p "$SHARED_KEY_FOLDER/.ssh"
  chown dokku:dokku "$SHARED_KEY_FOLDER/.ssh"
  chmod 700 "$SHARED_KEY_FOLDER/.ssh"
fi

if [[ ! -f "$SHARED_KEY_FOLDER/id_rsa" ]]; then
	ssh-keygen -q -t rsa -b 2048 -f "$SHARED_KEY_FOLDER/id_rsa" -N ""
fi